from pymatgen.core.structure import Structure
import asyncio 
import time
from pymatgen.analysis.local_env import CrystalNN, VoronoiNN, solid_angle, vol_tetra, _is_in_targets, _get_radius, _get_default_radius
import numpy as np
import math

lattice = [[21.627, 0.0, 0.0], [0.0, 21.404, 0.0], [0.0, 0.0, 10.057]]
atoms = ['Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Al', 'Si', 'Al', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'O', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'Si', 'C', 'C', 'C', 'C', 'C', 'C', 'C', 'C']
matrix = [[0.345733, 1.846571, 4.451538], [1.890235, 4.522005, 4.451577], [1.89027, 0.954721, 9.479969], [0.345648, 3.630041, 9.480056], [0.345538, 0.062744, 1.933613], [1.890125, 2.738193, 1.933448], [0.345581, 0.062824, 6.962008], [1.889974, 2.738661, 6.962057], [0.345523, 1.846404, 2.555108], [1.890155, 4.521753, 2.555084], [1.890157, 0.955325, 7.583804], [0.345404, 3.630746, 7.583522], [0.345485, 0.062838, 0.050343], [1.89024, 2.737944, 0.050589], [0.345443, 0.062921, 5.078873], [1.89027, 2.738414, 5.079134], [3.434695, 1.846687, 4.451291], [4.979784, 4.522145, 4.451726], [4.979786, 0.954648, 9.480044], [3.434661, 3.630108, 9.479972], [3.4346, 0.062686, 1.933621], [4.979865, 2.738197, 1.933656], [3.434709, 0.063163, 6.962288], [4.979847, 2.738709, 6.962276], [3.434829, 1.846539, 2.55486], [4.97951, 4.522034, 2.555075], [4.979504, 0.95514, 7.583708], [3.434718, 3.630692, 7.583249], [3.434807, 0.063007, 0.05026], [4.979292, 2.738084, 0.050549], [3.434675, 0.063123, 5.079055], [4.97933, 2.738295, 5.079122], [6.524392, 1.846851, 4.451604], [8.069354, 4.52203, 4.451688], [8.069338, 0.954696, 9.480084], [6.524396, 3.629821, 9.480225], [6.524406, 0.062527, 1.933672], [8.069314, 2.738338, 1.933698], [6.524424, 0.063234, 6.962305], [8.069322, 2.738447, 6.962292], [6.524641, 1.846344, 2.555087], [8.069473, 4.522232, 2.555054], [8.069492, 0.954815, 7.583763], [6.524687, 3.630801, 7.583514], [6.52454, 0.06286, 0.050359], [8.06941, 2.738146, 0.050582], [6.524513, 0.063209, 5.079122], [8.069433, 2.738239, 5.079132], [9.614259, 1.846756, 4.45151], [11.158728, 4.522143, 4.45167], [11.158746, 0.954512, 9.480023], [9.614277, 3.629871, 9.480168], [9.614262, 0.062632, 1.933654], [11.158703, 2.738222, 1.933591], [9.614304, 0.063139, 6.962262], [11.1587, 2.738633, 6.962199], [9.614067, 1.84643, 2.555045], [11.158979, 4.521982, 2.555122], [11.159021, 0.955135, 7.583767], [9.614072, 3.630728, 7.58349], [9.614084, 0.062827, 0.050333], [11.159051, 2.737897, 0.050452], [9.614079, 0.063207, 5.07908], [11.159042, 2.738386, 5.079026], [12.703512, 1.846511, 4.451414], [14.248271, 4.522218, 4.451735], [14.248333, 0.95455, 9.480081], [12.703472, 3.630178, 9.480077], [12.703583, 0.062759, 1.933688], [14.248285, 2.738185, 1.933591], [12.70357, 0.062996, 6.962286], [14.24826, 2.73873, 6.962179], [12.703424, 1.846559, 2.554992], [14.247939, 4.521912, 2.555171], [14.247954, 0.955285, 7.583827], [12.703396, 3.630635, 7.583454], [12.703519, 0.063044, 0.050393], [14.24798, 2.737974, 0.050482], [12.703495, 0.063039, 5.079126], [14.248004, 2.738429, 5.07904], [15.792884, 1.846784, 4.451556], [17.3382, 4.522146, 4.451653], [17.338281, 0.954709, 9.47999], [15.792908, 3.629959, 9.480193], [15.792875, 0.062672, 1.933709], [17.338195, 2.738266, 1.933697], [15.79285, 0.063209, 6.962408], [17.338252, 2.738598, 6.96229], [15.793084, 1.846536, 2.555055], [17.338055, 4.522232, 2.554931], [17.33807, 0.954916, 7.583586], [15.793111, 3.630686, 7.583428], [15.793271, 0.063024, 0.05036], [17.338023, 2.738172, 0.050578], [15.793237, 0.063163, 5.079201], [17.337985, 2.738258, 5.079114], [18.882895, 1.846833, 4.451514], [20.427672, 4.522246, 4.451718], [20.427774, 0.954517, 9.480091], [18.882847, 3.629986, 9.480127], [18.883165, 0.062576, 1.933765], [20.427751, 2.738473, 1.933659], [18.883104, 0.063103, 6.962204], [20.427896, 2.738519, 6.962234], [18.882959, 1.846382, 2.555145], [20.42793, 4.522258, 2.555236], [20.428037, 0.954964, 7.583808], [18.883013, 3.63081, 7.583529], [18.882973, 0.062806, 0.050601], [20.428064, 2.738162, 0.050492], [18.883085, 0.063213, 5.079138], [20.427989, 2.738328, 5.079068], [0.345651, 7.197826, 4.451709], [1.89032, 9.873243, 4.451631], [1.890297, 6.305751, 9.48015], [0.345645, 8.981174, 9.480183], [0.345449, 5.414147, 1.933639], [1.890099, 8.089384, 1.93339], [0.345504, 5.4144, 6.961972], [1.890123, 8.089895, 6.961851], [0.345449, 7.197779, 2.555266], [1.890226, 9.872774, 2.55517], [1.89019, 6.306491, 7.583726], [0.345473, 8.981533, 7.5837], [0.345475, 5.41384, 0.050535], [1.890298, 8.089153, 0.050606], [0.3455, 5.414011, 5.078824], [1.890261, 8.089733, 5.078986], [3.434692, 7.197633, 4.451588], [4.979826, 9.873376, 4.451779], [4.979774, 6.305577, 9.480337], [3.434702, 8.981372, 9.480084], [3.434669, 5.413892, 1.933623], [4.979881, 8.089293, 1.933599], [3.434638, 5.4145, 6.961976], [4.979874, 8.089965, 6.962097], [3.434793, 7.197635, 2.554956], [4.979578, 9.873001, 2.55511], [4.979488, 6.3062, 7.583654], [3.434796, 8.981669, 7.583471], [3.43472, 5.413721, 0.050534], [4.979353, 8.089338, 0.050527], [3.43473, 5.41389, 5.078828], [4.979351, 8.089595, 5.078964], [6.524446, 7.197927, 4.451836], [8.069404, 9.873296, 4.451759], [8.06937, 6.305692, 9.480311], [6.524465, 8.981119, 9.480334], [6.524464, 5.413821, 1.93367], [8.069367, 8.089474, 1.933645], [6.52445, 5.414581, 6.962039], [8.069373, 8.089764, 6.962137], [6.524697, 7.197545, 2.555213], [8.069526, 9.873234, 2.555124], [8.069508, 6.305944, 7.583664], [6.524715, 8.981766, 7.583696], [6.524587, 5.413579, 0.050603], [8.069462, 8.089417, 0.050607], [6.524607, 5.414091, 5.07891], [8.06946, 8.089561, 5.079031], [9.614264, 7.197854, 4.451744], [11.158723, 9.87344, 4.451716], [11.158696, 6.305536, 9.480282], [9.614295, 8.981181, 9.480266], [9.614281, 5.413914, 1.933664], [11.158709, 8.089356, 1.933516], [9.614299, 5.414494, 6.962011], [11.15871, 8.08996, 6.961995], [9.614099, 7.197635, 2.555184], [11.158994, 9.872974, 2.555174], [11.158981, 6.306304, 7.583712], [9.614111, 8.981692, 7.5837], [9.61406, 5.413555, 0.05058], [11.159046, 8.0892, 0.050466], [9.614089, 5.414098, 5.078873], [11.159034, 8.089741, 5.078877], [12.703478, 7.197611, 4.451654], [14.248259, 9.873466, 4.451795], [14.24828, 6.305537, 9.480344], [12.703459, 8.981495, 9.48019], [12.703502, 5.414077, 1.933662], [14.248255, 8.089285, 1.933532], [12.703479, 5.414375, 6.962019], [14.248244, 8.090038, 6.962014], [12.703391, 7.197775, 2.55515], [14.247932, 9.872885, 2.55522], [14.24791, 6.306389, 7.583742], [12.703385, 8.981614, 7.583654], [12.703446, 5.413788, 0.050597], [14.247951, 8.089241, 0.050496], [12.70345, 5.413924, 5.0789], [14.24799, 8.089727, 5.078912], [15.792889, 7.197831, 4.451808], [17.338131, 9.873397, 4.45171], [17.338189, 6.305651, 9.480252], [15.792847, 8.981278, 9.480323], [15.792834, 5.413884, 1.933752], [17.338145, 8.089448, 1.933637], [15.792811, 5.414553, 6.962106], [17.338137, 8.089857, 6.962117], [15.793075, 7.197674, 2.555166], [17.337986, 9.873239, 2.55498], [17.338035, 6.306001, 7.583526], [15.793063, 8.981696, 7.583671], [15.793194, 5.413729, 0.050656], [17.337955, 8.089408, 0.05057], [15.793177, 5.413983, 5.078961], [17.337971, 8.089612, 5.078995], [18.882819, 7.19782, 4.451771], [20.427647, 9.873481, 4.451809], [20.427684, 6.305521, 9.480315], [18.882806, 8.981276, 9.480251], [18.883049, 5.413996, 1.9336], [20.427796, 8.089564, 1.9336], [18.883071, 5.414459, 6.96197], [20.427768, 8.089767, 6.962055], [18.88291, 7.197575, 2.555233], [20.427931, 9.873219, 2.555271], [20.427994, 6.306068, 7.583763], [18.882905, 8.981766, 7.58374], [18.882903, 5.413536, 0.050778], [20.427975, 8.089403, 0.050494], [18.882941, 5.414143, 5.079072], [20.427948, 8.089627, 5.078889], [0.345669, 12.548872, 4.45161], [1.890298, 15.224154, 4.451545], [1.89035, 11.656961, 9.479972], [0.34571, 14.332366, 9.479948], [0.34552, 10.764941, 1.933564], [1.890118, 13.440382, 1.933454], [0.34554, 10.765141, 6.962062], [1.890092, 13.440978, 6.961966], [0.345449, 12.548631, 2.555052], [1.890182, 15.223965, 2.55493], [1.890232, 11.657571, 7.583552], [0.345478, 14.332921, 7.583535], [0.345522, 10.765001, 0.050415], [1.890307, 13.440336, 0.050601], [0.345555, 10.765173, 5.078938], [1.890274, 13.44069, 5.079149], [3.434723, 12.548758, 4.451473], [4.979787, 15.224333, 4.45169], [4.979817, 11.656892, 9.480138], [3.434666, 14.332575, 9.479881], [3.43474, 10.764742, 1.933534], [4.979894, 13.440326, 1.933681], [3.434721, 10.765339, 6.962058], [4.979868, 13.441097, 6.962238], [3.434817, 12.548519, 2.554767], [4.979543, 15.224235, 2.554831], [4.979529, 11.657342, 7.583506], [3.434752, 14.333063, 7.583295], [3.434813, 10.765001, 0.050437], [4.979345, 13.440624, 0.050538], [3.434807, 10.765156, 5.078969], [4.979369, 13.440613, 5.079157], [6.524466, 12.549057, 4.451752], [8.069393, 15.224251, 4.451672], [8.069405, 11.657006, 9.480115], [6.52446, 14.332328, 9.480114], [6.52452, 10.764663, 1.933589], [8.069393, 13.440528, 1.933711], [6.524498, 10.765473, 6.962128], [8.069384, 13.440892, 6.962259], [6.524728, 12.548436, 2.55501], [8.069527, 15.22447, 2.554849], [8.069543, 11.657102, 7.583527], [6.524726, 14.333159, 7.583529], [6.52463, 10.764925, 0.050496], [8.069472, 13.440704, 0.050595], [6.524635, 10.765334, 5.079045], [8.069479, 13.440591, 5.079209], [9.61429, 12.548995, 4.451652], [11.158762, 15.224383, 4.451646], [11.158715, 11.65685, 9.48008], [9.614306, 14.332406, 9.480049], [9.614319, 10.764763, 1.933576], [11.158736, 13.44041, 1.933588], [9.614321, 10.765375, 6.962116], [11.158721, 13.441072, 6.962136], [9.614123, 12.548535, 2.554981], [11.159033, 15.224215, 2.55491], [11.159, 11.657435, 7.583565], [9.61412, 14.333111, 7.583518], [9.614089, 10.764898, 0.050484], [11.159063, 13.440476, 0.050462], [9.614108, 10.765364, 5.079035], [11.159062, 13.440759, 5.079069], [12.703495, 12.548738, 4.451558], [14.248313, 15.224415, 4.451693], [14.248283, 11.656866, 9.480149], [12.70349, 14.332698, 9.479985], [12.703499, 10.764922, 1.933576], [14.248275, 13.440338, 1.933584], [12.703497, 10.765266, 6.962108], [14.248261, 13.441174, 6.962137], [12.703416, 12.548675, 2.554947], [14.24798, 15.224105, 2.554948], [14.247907, 11.657558, 7.583599], [12.703399, 14.333, 7.583496], [12.703464, 10.765136, 0.0505], [14.248012, 13.440544, 0.050478], [12.703457, 10.765165, 5.079041], [14.248007, 13.440751, 5.079095], [15.792886, 12.548958, 4.451708], [17.338191, 15.224318, 4.451634], [17.338183, 11.656983, 9.48005], [15.79291, 14.332501, 9.480075], [15.792792, 10.764777, 1.933664], [17.338197, 13.440482, 1.93372], [15.792788, 10.765436, 6.962193], [17.338198, 13.441007, 6.962263], [15.793097, 12.548598, 2.554962], [17.338054, 15.224469, 2.554711], [17.338027, 11.657149, 7.58336], [15.793079, 14.333092, 7.583462], [15.793198, 10.765073, 0.05055], [17.338001, 13.440704, 0.050576], [15.793144, 10.765252, 5.0791], [17.337984, 13.440603, 5.079179], [18.88284, 12.548925, 4.451689], [20.427668, 15.224301, 4.451718], [20.427677, 11.656733, 9.480097], [18.882872, 14.33248, 9.480045], [18.883009, 10.764839, 1.933534], [20.427799, 13.44056, 1.93367], [18.883058, 10.765297, 6.962051], [20.427828, 13.440799, 6.962157], [18.882948, 12.548439, 2.555062], [20.427967, 15.224329, 2.555045], [20.427988, 11.657139, 7.583608], [18.883012, 14.333174, 7.583563], [18.882864, 10.764841, 0.050674], [20.428019, 13.440563, 0.0505], [18.882884, 10.765385, 5.079191], [20.427982, 13.440549, 5.07907], [0.345751, 17.899864, 4.451725], [1.890125, 20.575741, 4.451745], [1.890319, 17.008363, 9.48004], [0.345679, 19.683085, 9.480272], [0.345467, 16.116245, 1.933384], [1.890035, 18.791679, 1.933419], [0.345596, 16.116527, 6.962086], [1.890114, 18.792174, 6.96149], [0.345491, 17.899889, 2.555165], [1.889991, 20.575101, 2.55526], [1.890237, 17.009157, 7.583664], [0.345446, 19.683288, 7.583314], [0.345554, 16.11611, 0.050253], [1.89027, 18.791326, 0.050915], [0.345529, 16.116081, 5.078997], [1.890206, 18.792105, 5.078929], [3.434638, 17.899859, 4.45161], [4.979678, 20.575785, 4.451764], [4.979812, 17.008298, 9.480214], [3.434652, 19.68319, 9.480183], [3.434666, 16.116102, 1.933366], [4.979839, 18.791669, 1.933706], [3.434707, 16.116774, 6.962089], [4.979841, 18.7923, 6.961674], [3.434748, 17.899871, 2.554826], [4.979405, 20.57532, 2.55525], [4.979499, 17.008984, 7.58361], [3.434752, 19.683331, 7.583186], [3.434793, 16.116173, 0.05024], [4.979318, 18.791561, 0.05092], [3.43474, 16.116145, 5.079006], [4.979314, 18.791989, 5.078852], [6.524407, 17.900099, 4.451896], [8.069291, 20.575744, 4.451754], [8.069399, 17.008461, 9.4802], [6.524411, 19.682996, 9.480454], [6.524507, 16.116061, 1.933436], [8.06933, 18.791885, 1.933757], [6.524472, 16.116889, 6.962192], [8.069331, 18.792181, 6.961709], [6.524663, 17.899796, 2.55511], [8.069436, 20.575558, 2.555313], [8.069529, 17.008788, 7.583603], [6.524642, 19.683522, 7.583408], [6.524631, 16.11607, 0.050312], [8.069457, 18.791717, 0.050982], [6.524612, 16.116313, 5.079111], [8.069437, 18.791997, 5.07886], [9.61429, 17.900056, 4.451796], [11.158779, 20.575848, 4.451681], [11.158737, 17.008301, 9.480183], [9.614321, 19.68306, 9.480369], [9.614329, 16.11617, 1.93343], [11.158741, 18.79178, 1.933648], [9.614336, 16.116812, 6.962166], [11.15875, 18.792352, 6.961597], [9.614103, 17.899909, 2.555064], [11.159018, 20.57532, 2.555332], [11.159033, 17.009116, 7.583662], [9.614102, 19.683446, 7.583384], [9.614102, 16.116052, 0.050295], [11.15912, 18.791487, 0.050863], [9.614123, 16.116353, 5.079068], [11.159075, 18.792164, 5.07874], [12.703544, 17.8998, 4.451711], [14.248383, 20.575905, 4.451793], [14.24834, 17.008291, 9.480223], [12.703547, 19.683361, 9.48027], [12.703563, 16.116324, 1.933415], [14.248331, 18.791688, 1.933634], [12.703533, 16.116665, 6.962157], [14.248343, 18.792411, 6.961597], [12.703449, 17.900033, 2.555033], [14.248074, 20.575197, 2.555382], [14.247944, 17.009198, 7.583684], [12.70346, 19.683329, 7.583337], [12.703504, 16.116277, 0.050296], [14.248046, 18.791496, 0.050887], [12.703509, 16.116157, 5.079073], [14.248065, 18.792154, 5.078776], [15.792883, 17.899947, 4.451812], [17.338173, 20.575746, 4.451757], [17.338246, 17.008373, 9.480116], [15.792939, 19.683131, 9.480406], [15.792842, 16.116143, 1.933498], [17.338154, 18.791744, 1.933708], [15.792856, 16.116876, 6.962261], [17.338234, 18.792192, 6.961708], [15.793102, 17.899908, 2.55506], [17.338005, 20.575492, 2.555134], [17.338077, 17.008792, 7.583465], [15.793171, 19.683398, 7.583344], [15.79325, 16.116228, 0.050369], [17.338018, 18.791615, 0.050949], [15.793205, 16.116191, 5.079182], [17.337899, 18.791906, 5.078898], [18.882812, 17.899984, 4.451902], [20.427561, 20.575938, 4.451666], [20.427764, 17.008193, 9.4802], [18.882819, 19.683103, 9.480328], [18.883115, 16.116161, 1.933374], [20.427752, 18.792048, 1.933857], [18.883091, 16.116759, 6.962079], [20.427863, 18.792177, 6.961629], [18.8829, 17.899725, 2.555153], [20.427951, 20.575609, 2.555531], [20.428056, 17.00882, 7.583702], [18.88294, 19.683456, 7.583452], [18.882924, 16.11601, 0.050493], [20.428063, 18.791676, 0.050962], [18.88296, 16.116338, 5.079201], [20.427973, 18.792149, 5.078675]]
structure = Structure(lattice, atoms, matrix, 0, to_unit_cell=True, coords_are_cartesian=True)

class var_iterator():
    def __init__(self, var):
        self.want = var
        self.counter = -1
    def __aiter__(self):
        return self
    async def __anext__(self):
        if self.counter >= len(self.want)-1:
            raise StopAsyncIteration
        self.counter +=1
        return self.want[self.counter]   

class PeriodicNN(CrystalNN):
    def __init__(self, cation_anion=False, distance_cutoffs=(0.5, 1)):
        super().__init__(False, cation_anion, distance_cutoffs,3.0, True, 7, None)
        
    async def get_nn_info(self, structure: Structure,  tot_num: int = None):
        await self.get_nn_data(structure, n=tot_num) #nndata = 

        # return nndata.all_nninfo

    async def get_nn_data(self, structure, n, length=None):
        target = None
        if self.cation_anion:
            tasks = [asyncio.create_task(self.cat_an_ion(structure, i)) for i in range(n)]
            target = await asyncio.gather(*tasks)
            print(target)

    async def cat_an_ion(self, structure, i):
        target = []
        await asyncio.sleep(0.01)
        m_oxi = structure[i].specie.oxi_state
        async for site in var_iterator(structure):
            await asyncio.sleep(0.005)
            if site.specie.oxi_state * m_oxi <= 0:  # opposite charge
                target.append(site.specie)
        if not target:
            raise ValueError(f"No valid targets for site {i} within cation_anion constraint!")
        else:
            return target
        
async def main():
    await PeriodicNN(distance_cutoffs=(0.5, 1.5), cation_anion=True).get_nn_info(structure, len(structure))
t = time.time()
asyncio.run(main())
print('taken :',time.time()-t,'seconds')